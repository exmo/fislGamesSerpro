@(list: List[QRCode],qrcodeForm: Form[QRCode])(implicit flash: Flash)

@import helper._

@geraTextoQrcode(q:QRCode) = {SERPRO#@q.tipo#@q.id}
<script>
    function gerarQRCode() {
    }
</script>

@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.f) }

@main("Formulário de QR Code's") {
    <h1>@list.size QRCode(s)</h1>

    <table class="table table-striped table-bordered footable">
        <thead>
        <tr>
            @footable_header(title = "#", expand = true)
            @footable_header(title = "Evento", hideDevices = "phone")
            @footable_header(title = "Texto", sort = true)
            @footable_header(title = "Tipo", sort = true)
            @footable_header(title = "Resposta", hideDevices = "phone")
            @footable_header(title = "Alternativas", hideDevices = "phone,tablet")
            @footable_header(title = "Pontuação", hideDevices = "phone", sort = true)
            @footable_header(title = "QR-Code")
            @footable_header(title = "Ações")
        </tr>
        </thead>
        <tbody>
        @list.map{ q =>
            <tr>
                <td data-class="expand">@q.id</td>
                <td data-hide="phone,tablet">@q.evento_id</td>
                <td>@q.texto</td>
                <td>@q.tipo</td>
                <td data-hide="phone,tablet">@q.resposta</td>
                <td data-hide="phone,tablet">@q.alternativas</td>
                <td>@q.pontuacao</td>
                <td>
                    <form name="qrForm@q.id.get" action="/qrcode/render" method="post">
                    <input type="hidden" id="texto@q.id.get" name="texto" value="@geraTextoQrcode(q)"/>
                    <input type="hidden" name="size" value="320"/>
                    <input type="hidden" name="id" value="@q.id"/>
                    <div id="qr@q.id" onclick="document.forms['qrForm@q.id'].submit();"></div>
                    </form>
                </td>
                <td>
                    @form(routes.QRCodes.deleteQRCode(q.id.get)) {
                        <input type="submit" value="   Delete    " class="btn btn-danger" onclick="return confirm('Tem certeza?');" />
                    }
                    @if(q.tipo.startsWith("DESAFIO")){
                    <p>
                        <a href="/todasrespostas/@q.id" class="btn btn-info" />Respostas</a>
                    </p>
                    }                    
                </td>
                <script>
                    $('#qr@q.id').qrcode({
                        width: 64,
                        height: 64,
                        text: '@geraTextoQrcode(q)'
                    });
                </script>
            </tr>
        }
        </tbody>
    </table>

    @form(routes.QRCodes.gerarQRCode, 'class -> "form-horizontal") {
        <fieldset>
                <legend><strong>Incluir QR-Code</strong></legend>

                @qrcodeForm.globalError.map { error =>
                <div class="alert alert-error">
                    @error.message
                </div>
                }

                @flash.get("success").map { message =>
                <div class="alert alert-success">
                    @message
                </div>
                }

                @textarea(qrcodeForm("texto"), '_label -> "Texto")
                @select(qrcodeForm("tipo"),
                options("INFO"->"Info","URL"->"URL","DESAFIO"->"Desafio","DESAFIOME"->"Desafio Multipla Escolha"),
                '_label -> "Tipo", '_id->"tipo", 'onchange->"verificaTipo()")

                <div id="desafio">
                    @textarea(qrcodeForm("resposta"), '_label -> "Resposta")
                </div>
                <div id="desafioMultiplaEscolha">
                    <input type="hidden" id="alternativas" name="alternativas" value=""/>
                    @textarea(qrcodeForm("alternativa"), '_label -> "Alternativa")
                    <div id="divAlternativas">

                    </div>
                </div>
                <div id="divPontuacao">
                    @inputText(qrcodeForm("pontuacao"), '_label -> "Pontuação")
                </div>

                <script>
                    $("#alternativa").parent().children('span').html('<input id="botaoAdicionaAlternativa" type="button" value="+" class="btn btn-primary" onclick="incluirAlternativa();">');
                    var cont = 1;

                    function verificaTipo(){
                       if($('#tipo').val() == "DESAFIO"){
                           $('#desafio').show();
                           $('#divPontuacao').show();
                           $('#desafioMultiplaEscolha').hide();
                           $('#alternativas').val("");
                           $('#alternativa').val("");
                           $('#divAlternativas').empty();
                       }else{
                           if($('#tipo').val() == "DESAFIOME"){
                               $('#desafio').show();
                               $('#desafioMultiplaEscolha').show();
                               $('#divPontuacao').show();
                           }else{
                               $('#desafio').hide();
                               $('#divPontuacao').hide();
                               $('#desafioMultiplaEscolha').hide();
                               $('#alternativas').val("");
                               $('#alternativa').val("");
                               $('#pontuacao').val("");
                               $('#resposta').val("");
                               $('#divAlternativas').empty();
                           }
                       }
                    }

                    function incluirAlternativa(){
                        if($('#alternativa').val() != ""){
                            $('<div>').attr('id','divControlGroup'+cont).attr('class','control-group').appendTo('#divAlternativas');
                            $('<label>').attr('class','control-label').attr('for','alternativa'+cont).html('Alternativa '+cont).appendTo('#divControlGroup'+cont);
                            $('<div>').attr('class','controls').attr('id','divControls'+cont).appendTo('#divControlGroup'+cont);
                            $('<textarea>').attr('disabled','true').attr('id','alternativa'+cont).html($('#alternativa').val()).appendTo('#divControls'+cont);
                            $('<span>').attr('class','help-inline').appendTo('#divControls'+cont);
                            $('#alternativas').val($('#alternativas').val()+'#'+$('#alternativa').val());
                            $('#alternativa').val("");
                            cont = cont +1;
                        }else{
                            alert("Você precisa informar um texto para a alternativa!");
                        }
                    }

                    $('#desafio').hide();
                    $('#divPontuacao').hide();
                    $('#desafioMultiplaEscolha').hide();
                </script>


                <!-- Button -->
                <div class="form-actions">
                    <input type="submit" value="Incluir" class="btn btn-primary">
                </div>
        </fieldset>
    }
}
